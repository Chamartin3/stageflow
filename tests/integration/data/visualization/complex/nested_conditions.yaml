# Case 3.2: Deeply Nested Conditions
# Tests: Complex process with multiple conditional branches and loops

process:
  name: complex_content_lifecycle
  initial_stage: content_submitted
  final_stage: content_archived

  stages:
    content_submitted:
      gates:
        auto_publish_trusted:
          target_stage: content_published
          locks:
          - type: equals
            property_path: "author.trust_level"
            expected_value: "high"
          - type: in_list
            property_path: "content_type"
            expected_value: ["article", "blog_post"]
          - type: less_than
            property_path: "content.word_count"
            expected_value: 1000

        basic_moderation:
          target_stage: basic_moderation_queue
          locks:
          - type: equals
            property_path: "author.trust_level"
            expected_value: "medium"
          - type: not_in_list
            property_path: "content_type"
            expected_value: ["video", "live_stream"]

        advanced_moderation:
          target_stage: advanced_moderation_queue
          locks:
          - type: in_list
            property_path: "author.trust_level"
            expected_value: ["low", "new"]

        special_content_review:
          target_stage: special_review_queue
          locks:
          - type: in_list
            property_path: "content_type"
            expected_value: ["video", "live_stream", "podcast"]

      fields:
      - content_id
      - content_type
      - author_id
      - author.trust_level
      - content.word_count

    basic_moderation_queue:
      gates:
        approve_basic:
          target_stage: content_published
          locks:
          - type: equals
            property_path: "moderation.decision"
            expected_value: "approved"

        reject_basic:
          target_stage: content_rejected
          locks:
          - type: equals
            property_path: "moderation.decision"
            expected_value: "rejected"

        escalate_to_advanced:
          target_stage: advanced_moderation_queue
          locks:
          - type: equals
            property_path: "moderation.decision"
            expected_value: "escalate"

      fields:
      - content_id
      - assigned_moderator
      - moderation_priority
      - moderation.decision

    advanced_moderation_queue:
      gates:
        approve_advanced:
          target_stage: content_published
          locks:
          - type: equals
            property_path: "advanced_moderation.decision"
            expected_value: "approved"

        reject_advanced:
          target_stage: content_rejected
          locks:
          - type: equals
            property_path: "advanced_moderation.decision"
            expected_value: "rejected"

        request_author_revision:
          target_stage: revision_requested
          locks:
          - type: equals
            property_path: "advanced_moderation.decision"
            expected_value: "needs_revision"

        escalate_to_committee:
          target_stage: committee_review
          locks:
          - type: equals
            property_path: "advanced_moderation.decision"
            expected_value: "committee_review"

      fields:
      - content_id
      - senior_moderator
      - detailed_review_required
      - advanced_moderation.decision

    special_review_queue:
      gates:
        approve_special:
          target_stage: content_published
          locks:
          - type: equals
            property_path: "special_review.technical_approved"
            expected_value: true
          - type: equals
            property_path: "special_review.content_approved"
            expected_value: true

        reject_special:
          target_stage: content_rejected
          locks:
          - type: equals
            property_path: "special_review.final_decision"
            expected_value: "rejected"

      fields:
      - content_id
      - specialist_reviewer
      - technical_review_completed
      - special_review.technical_approved
      - special_review.content_approved
      - special_review.final_decision

    revision_requested:
      gates:
        resubmit_after_revision:
          target_stage: basic_moderation_queue
          locks:
          - exists: "revision.resubmitted_content"
          - type: equals
            property_path: "revision.author_revised"
            expected_value: true

        abandon_revision:
          target_stage: content_abandoned
          locks:
          - type: equals
            property_path: "revision.abandoned"
            expected_value: true

      fields:
      - content_id
      - revision_notes
      - revision_deadline
      - revision.resubmitted_content
      - revision.author_revised
      - revision.abandoned

    committee_review:
      gates:
        committee_approve:
          target_stage: content_published
          locks:
          - type: equals
            property_path: "committee.decision"
            expected_value: "approved"
          - type: greater_than
            property_path: "committee.approval_votes"
            expected_value: 2

        committee_reject:
          target_stage: content_rejected
          locks:
          - type: equals
            property_path: "committee.decision"
            expected_value: "rejected"

      fields:
      - content_id
      - committee_members
      - review_meeting_scheduled
      - committee.decision
      - committee.approval_votes

    content_published:
      gates:
        schedule_review:
          target_stage: periodic_review
          locks:
          - exists: "next_review_date"

        archive_old_content:
          target_stage: content_archived
          locks:
          - type: equals
            property_path: "lifecycle.archive_requested"
            expected_value: true

      fields:
      - content_id
      - publication_date
      - approval_path
      - next_review_date
      - lifecycle.archive_requested

    periodic_review:
      gates:
        keep_published:
          target_stage: content_published
          locks:
          - type: equals
            property_path: "periodic_review.decision"
            expected_value: "keep_published"

        archive_content:
          target_stage: content_archived
          locks:
          - type: equals
            property_path: "periodic_review.decision"
            expected_value: "archive"

        update_required:
          target_stage: revision_requested
          locks:
          - type: equals
            property_path: "periodic_review.decision"
            expected_value: "needs_update"

      fields:
      - content_id
      - review_date
      - reviewer_id
      - periodic_review.decision

    content_rejected:
      gates:
        archive_rejected:
          target_stage: content_archived
          locks:
          - type: equals
            property_path: "rejection_acknowledged"
            expected_value: true

      fields:
      - content_id
      - rejection_reason
      - rejection_date
      - rejection_acknowledged

    content_abandoned:
      gates:
        archive_abandoned:
          target_stage: content_archived
          locks:
          - type: equals
            property_path: "abandonment_finalized"
            expected_value: true

      fields:
      - content_id
      - abandonment_reason
      - abandonment_date
      - abandonment_finalized

    content_archived:
      fields:
      - content_id
      - archive_date
      - archive_reason

  allow_stage_skipping: false
  regression_detection: true

  metadata:
    description: "Complex content lifecycle with nested conditions and loops for visualization
      testing"
    version: "1.0.0"
    test_case: "visualization_nested_conditions"
    visualization_notes: "Should show complex branching with loops, escalation paths,
      and multiple decision points"
