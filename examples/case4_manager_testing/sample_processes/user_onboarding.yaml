process:
  name: "user_onboarding"
  description: "User onboarding workflow with multiple stages"
  initial_stage: "email_signup"
  final_stage: "active_user"

  stages:
    email_signup:
      name: "Email Signup"
      description: "User provides email and creates account"
      gates:
        email_verified:
          target_stage: "profile_setup"
          locks:
          - type: exists
            property_path: "email"
          - type: exists
            property_path: "user_id"
          - type: exists
            property_path: "email_verified_at"
          - type: regex
            property_path: "email"
            expected_value: "^[^@]+@[^@]+\\.[^@]+$"

      fields:
      - email
      - user_id
      - email_verified_at

    profile_setup:
      name: "Profile Setup"
      description: "User completes profile information"
      gates:
        profile_complete:
          target_stage: "verification"
          locks:
          - type: exists
            property_path: "profile.first_name"
          - type: exists
            property_path: "profile.last_name"
          - type: not_empty
            property_path: "profile.first_name"

      fields:
      - profile
      - profile.first_name
      - profile.last_name

    verification:
      name: "Verification"
      description: "Identity verification process"
      gates:
        verification_approved:
          target_stage: "active_user"
          locks:
          - type: equals
            property_path: "verification.document_uploaded"
            expected_value: true
          - type: equals
            property_path: "verification.status"
            expected_value: "approved"

      fields:
      - verification
      - verification.document_uploaded
      - verification.status

    active_user:
      name: "Active User"
      description: "User account is fully active"
      fields:
      - status
      - activated_at

  allow_stage_skipping: false
  regression_detection: true
