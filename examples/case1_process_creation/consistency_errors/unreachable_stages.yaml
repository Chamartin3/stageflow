# Consistency Error: Unreachable Stages
# Tests: Stages that cannot be reached from the initial stage
# Expected Errors:
#   - "Stage 'isolated_stage_1' is unreachable from initial stage 'start'"
#   - "Stage 'isolated_stage_2' is unreachable from initial stage 'start'"
#   - "Stage 'orphaned_stage' is unreachable from initial stage 'start'"
#   - "Stage 'dead_end' is unreachable from initial stage 'start'"
#   - "Infinite cycle detected with no path to final stage: isolated_stage_1 → isolated_stage_2 → isolated_stage_1"
#
# Unreachable stages are orphaned from the main process flow.

process:
  name: unreachable_stages
  initial_stage: start
  final_stage: reachable_end

  stages:
    # Main reachable flow: start -> middle -> reachable_end
    start:
      fields:
        - initial_data
      gates:
        proceed:
          target_stage: middle
          locks:
            - exists: "initial_data"

    middle:
      fields:
        - initial_data
        - middle_data
      gates:
        finish:
          target_stage: reachable_end
          locks:
            - exists: "middle_data"

    reachable_end:
      fields:
        - final_data

    # UNREACHABLE: These stages form an isolated island
    isolated_stage_1:
      fields:
        - isolated_data_1
      gates:
        go_to_isolated_2:
          target_stage: isolated_stage_2
          locks:
            - exists: "isolated_data_1"

    isolated_stage_2:
      fields:
        - isolated_data_1
        - isolated_data_2
      gates:
        # Creates an isolated loop that cannot reach final
        back_to_isolated_1:
          target_stage: isolated_stage_1
          locks:
            - exists: "isolated_data_2"

    # UNREACHABLE: Orphaned stage with no connections
    orphaned_stage:
      fields:
        - orphaned_data

    # UNREACHABLE: Another orphaned stage
    dead_end:
      fields:
        - dead_end_data

  allow_stage_skipping: false
  regression_detection: true

  metadata:
    description: "Process with unreachable stages"
    test_case: "consistency_unreachable_stages"
    expected_errors:
      - "Stage 'isolated_stage_1' is unreachable from initial stage 'start'"
      - "Stage 'isolated_stage_2' is unreachable from initial stage 'start'"
      - "Stage 'orphaned_stage' is unreachable from initial stage 'start'"
      - "Stage 'dead_end' is unreachable from initial stage 'start'"
      - "Infinite cycle detected with no path to final stage: isolated_stage_1 → isolated_stage_2 → isolated_stage_1"
