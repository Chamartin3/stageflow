# Example: Simple Controlled Cycle with Iteration Counter
# Use Case: Payment retry with maximum 3 attempts

process:
  name: payment_retry_simple
  initial_stage: initiate
  final_stage: completed

  # Cycle control configuration
  cycle_control:
    enabled: true
    strategy: iteration_counter
    iteration_property: "attempt_number"
    default_max_iterations: 3

  stages:
    initiate:
      schema:
        required_fields:
          - payment.amount
          - attempt_number

      gates:
        process:
          target_stage: processing
          locks:
            - exists: "payment.amount"
            - type: greater_than
              property_path: "payment.amount"
              expected_value: 0

    processing:
      schema:
        required_fields:
          - payment.status
          - attempt_number

      gates:
        # Success path
        success:
          target_stage: completed
          locks:
            - type: equals
              property_path: "payment.status"
              expected_value: "success"

        # CYCLE: Retry on failure (back to initiate)
        retry:
          target_stage: initiate
          increment_property: "attempt_number"
          locks:
            - type: equals
              property_path: "payment.status"
              expected_value: "failed"
            - type: less_than
              property_path: "attempt_number"
              expected_value: 3  # Max 3 attempts

        # Give up after max attempts
        give_up:
          target_stage: failed
          locks:
            - type: equals
              property_path: "payment.status"
              expected_value: "failed"
            - type: greater_than
              property_path: "attempt_number"
              expected_value: 2  # After 3rd attempt

    completed:
      schema:
        required_fields:
          - payment.status
          - payment.transaction_id

    failed:
      schema:
        required_fields:
          - payment.status
          - payment.error_message

  metadata:
    description: "Simple payment retry process with iteration counter"
    version: "1.0.0"
