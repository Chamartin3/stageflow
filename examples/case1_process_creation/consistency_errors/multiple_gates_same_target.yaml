# Consistency Error: Multiple Gates Same Target
# Tests: Multiple gates from one stage targeting the same destination stage
# Expected Error: "Stage 'review' has multiple gates targeting the same stage 'published': standard_approval, fast_track_approval. Consider combining these gates into a single gate with multiple locks."
#
# While not always wrong, this pattern often indicates that gates should be
# combined using OR_LOGIC locks instead of separate gates.

process:
  name: multiple_gates_same_target
  initial_stage: draft
  final_stage: published

  stages:
    draft:
      fields:
        - content_id
        - title
      gates:
        ready_for_review:
          target_stage: review
          locks:
            - exists: "title"
            - type: not_empty
              property_path: "title"

    review:
      fields:
        - content_id
        - title
        - reviewer_assigned
        - review_status
        - approved_at
        - priority
        - fast_track_approved_by
      gates:
        # Both gates target 'published' - potential design issue
        standard_approval:
          target_stage: published
          locks:
            - type: equals
              property_path: "review_status"
              expected_value: "approved"
            - exists: "approved_at"

        fast_track_approval:
          target_stage: published
          locks:
            - type: equals
              property_path: "priority"
              expected_value: "urgent"
            - exists: "fast_track_approved_by"

    published:
      fields:
        - content_id
        - title
        - published_at

  allow_stage_skipping: false
  regression_detection: true

  metadata:
    description: "Process with multiple gates targeting same stage"
    test_case: "consistency_multiple_gates_same_target"
    expected_error: "Stage 'review' has multiple gates targeting the same stage 'published': standard_approval, fast_track_approval. Consider combining these gates into a single gate with multiple locks."
