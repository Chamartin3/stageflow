# Test data for ecommerce_order_fulfillment process
# Contains complex order scenarios demonstrating various business flows

test_cases:
  # Successful order completion - happy path
  - name: "successful_order_complete"
    description: "Order that successfully went through the entire fulfillment process"
    element:
      order_id: "ORD-2024-001"
      customer_id: "CUST-12345"
      items:
        - product_id: "LAPTOP-001"
          name: "Gaming Laptop"
          quantity: 1
          unit_price: 1299.99
        - product_id: "MOUSE-001"
          name: "Wireless Mouse"
          quantity: 1
          unit_price: 29.99
      total_amount: 1329.98
      shipping_address:
        street: "123 Main St"
        city: "Anytown"
        state: "CA"
        zip_code: "12345"
        country: "USA"
      payment:
        method: "credit_card"
        amount: 1329.98
        authorization_code: "AUTH-123456"
        transaction_id: "TXN-789012"
        processed_at: "2024-01-15T10:30:00Z"
      inventory:
        availability:
          - product_id: "LAPTOP-001"
            available: true
          - product_id: "MOUSE-001"
            available: true
        quantities:
          - product_id: "LAPTOP-001"
            available_quantity: 10
            reserved_quantity: 1
          - product_id: "MOUSE-001"
            available_quantity: 50
            reserved_quantity: 1
        reserved_at: "2024-01-15T10:35:00Z"
      fulfillment:
        picked_at: "2024-01-16T09:00:00Z"
        packed_at: "2024-01-16T10:30:00Z"
        warehouse_location: "WH-WEST"
      shipping:
        tracking_number: "TRK-1234567890"
        carrier: "FedEx"
        service_level: "Ground"
        shipped_at: "2024-01-16T14:00:00Z"
        delivered_at: "2024-01-18T16:30:00Z"
        delivery_status: "delivered"
    expected_stage: "order_delivered"
    expected_state: "completed"

  # New order waiting for payment
  - name: "order_pending_payment"
    description: "Newly placed order awaiting payment processing"
    element:
      order_id: "ORD-2024-002"
      customer_id: "CUST-23456"
      items:
        - product_id: "BOOK-001"
          name: "Programming Guide"
          quantity: 2
          unit_price: 39.99
      total_amount: 79.98
      shipping_address:
        street: "456 Oak Ave"
        city: "Springfield"
        state: "IL"
        zip_code: "62701"
        country: "USA"
      # Missing payment information
    expected_stage: "order_placed"
    expected_state: "awaiting"
    blocking_locks:
      - "payment_method_valid"

  # Order with partial payment
  - name: "order_payment_mismatch"
    description: "Order where payment amount doesn't match total"
    element:
      order_id: "ORD-2024-003"
      customer_id: "CUST-34567"
      items:
        - product_id: "SHIRT-001"
          name: "Cotton T-Shirt"
          quantity: 3
          unit_price: 24.99
      total_amount: 74.97
      shipping_address:
        street: "789 Pine Rd"
        city: "Portland"
        state: "OR"
        zip_code: "97201"
        country: "USA"
      payment:
        method: "credit_card"
        amount: 50.00  # Insufficient amount
        authorization_code: "AUTH-234567"
    expected_stage: "order_placed"
    expected_state: "awaiting"
    blocking_locks:
      - "payment_amount_matches"

  # Order with inventory shortage
  - name: "order_inventory_shortage"
    description: "Order where some items are out of stock"
    element:
      order_id: "ORD-2024-004"
      customer_id: "CUST-45678"
      items:
        - product_id: "PHONE-001"
          name: "Smartphone"
          quantity: 1
          unit_price: 799.99
        - product_id: "CASE-001"
          name: "Phone Case"
          quantity: 1
          unit_price: 19.99
      total_amount: 819.98
      shipping_address:
        street: "321 Elm St"
        city: "Denver"
        state: "CO"
        zip_code: "80201"
        country: "USA"
      payment:
        method: "debit_card"
        amount: 819.98
        authorization_code: "AUTH-345678"
        processed_at: "2024-01-15T11:00:00Z"
      inventory:
        availability:
          - product_id: "PHONE-001"
            available: false  # Out of stock
          - product_id: "CASE-001"
            available: true
      customer:
        allows_backorder: true
    expected_stage: "payment_processed"
    expected_state: "awaiting"
    available_transitions:
      - target: "awaiting_inventory"
        gate: "inventory_backorder"

  # Order in fulfillment process
  - name: "order_being_fulfilled"
    description: "Order currently being picked and packed"
    element:
      order_id: "ORD-2024-005"
      customer_id: "CUST-56789"
      items:
        - product_id: "HEADPHONES-001"
          name: "Bluetooth Headphones"
          quantity: 1
          unit_price: 149.99
      total_amount: 149.99
      shipping_address:
        street: "654 Maple Dr"
        city: "Austin"
        state: "TX"
        zip_code: "73301"
        country: "USA"
      payment:
        method: "paypal"
        amount: 149.99
        authorization_code: "AUTH-456789"
        processed_at: "2024-01-15T12:00:00Z"
      inventory:
        availability:
          - product_id: "HEADPHONES-001"
            available: true
        quantities:
          - product_id: "HEADPHONES-001"
            available_quantity: 25
            reserved_quantity: 1
        reserved_at: "2024-01-15T12:05:00Z"
      fulfillment:
        picked_at: "2024-01-16T10:00:00Z"
        # Missing packed_at and shipping info
    expected_stage: "inventory_reserved"
    expected_state: "fulfilling"
    blocking_locks:
      - "items_packed"
      - "shipping_label_created"

  # Order shipped but delivery failed
  - name: "order_delivery_failed"
    description: "Order shipped but delivery attempt failed"
    element:
      order_id: "ORD-2024-006"
      customer_id: "CUST-67890"
      items:
        - product_id: "WATCH-001"
          name: "Smart Watch"
          quantity: 1
          unit_price: 299.99
      total_amount: 299.99
      shipping_address:
        street: "987 Cedar Ln"
        city: "Miami"
        state: "FL"
        zip_code: "33101"
        country: "USA"
      payment:
        method: "credit_card"
        amount: 299.99
        authorization_code: "AUTH-567890"
        processed_at: "2024-01-14T14:00:00Z"
      inventory:
        availability:
          - product_id: "WATCH-001"
            available: true
        reserved_at: "2024-01-14T14:05:00Z"
      fulfillment:
        picked_at: "2024-01-15T09:00:00Z"
        packed_at: "2024-01-15T10:00:00Z"
      shipping:
        tracking_number: "TRK-9876543210"
        carrier: "UPS"
        service_level: "Next Day"
        shipped_at: "2024-01-15T15:00:00Z"
        delivery_status: "failed"
        delivery_attempts: 1
        failed_reason: "Customer not available"
      delivery_issue:
        type: "delivery_failed"
        reason: "Customer not available"
        occurred_at: "2024-01-16T18:00:00Z"
    expected_stage: "order_shipped"
    expected_state: "awaiting"
    available_transitions:
      - target: "delivery_problem"
        gate: "delivery_issue"

  # Backorder waiting for inventory
  - name: "order_awaiting_restock"
    description: "Order waiting for out-of-stock items to be restocked"
    element:
      order_id: "ORD-2024-007"
      customer_id: "CUST-78901"
      items:
        - product_id: "TABLET-001"
          name: "Tablet Computer"
          quantity: 1
          unit_price: 499.99
      total_amount: 499.99
      shipping_address:
        street: "147 Birch Ave"
        city: "Seattle"
        state: "WA"
        zip_code: "98101"
        country: "USA"
      payment:
        method: "credit_card"
        amount: 499.99
        authorization_code: "AUTH-678901"
        processed_at: "2024-01-10T10:00:00Z"
      backorder_info:
        items:
          - product_id: "TABLET-001"
            quantity: 1
            expected_restock_date: "2024-01-25"
        created_at: "2024-01-10T10:15:00Z"
        customer_notified_at: "2024-01-10T10:20:00Z"
      customer:
        allows_backorder: true
    expected_stage: "awaiting_inventory"
    expected_state: "awaiting"
    blocking_locks:
      - "backordered_items_available"

  # Cancelled order
  - name: "cancelled_order"
    description: "Order that was cancelled due to various reasons"
    element:
      order_id: "ORD-2024-008"
      customer_id: "CUST-89012"
      cancellation_reason: "Customer requested cancellation"
      status: "cancelled"
      cancelled_at: "2024-01-15T16:00:00Z"
      refund_processed: true
      refund_amount: 199.99
    expected_stage: "order_cancelled"
    expected_state: "completed"

expected_evaluation_results:
  # What each test case should produce when evaluated
  successful_order_complete:
    current_stage: "order_delivered"
    evaluation_state: "completed"
    can_advance: false
    can_regress: false
    actions: []
    completion_time: "2024-01-18T16:30:00Z"
    order_duration: "3 days"

  order_pending_payment:
    current_stage: "order_placed"
    evaluation_state: "awaiting"
    can_advance: false
    can_regress: false
    actions:
      - type: "process_payment"
        description: "Process customer payment for order"
        priority: "high"
    blocking_conditions:
      - lock: "payment_method_valid"
        reason: "No payment method provided"

  order_payment_mismatch:
    current_stage: "order_placed"
    evaluation_state: "awaiting"
    can_advance: false
    can_regress: false
    actions:
      - type: "request_additional_payment"
        description: "Request customer to provide additional payment"
        priority: "high"
    blocking_conditions:
      - lock: "payment_amount_matches"
        reason: "Payment amount ($50.00) is less than order total ($74.97)"

  order_inventory_shortage:
    current_stage: "payment_processed"
    evaluation_state: "awaiting"
    can_advance: false
    can_regress: false
    actions:
      - type: "create_backorder"
        description: "Create backorder for out-of-stock items"
        priority: "normal"
    next_stage_options:
      - stage: "awaiting_inventory"
        condition: "Customer accepts backorder"
      - stage: "order_cancelled"
        condition: "Customer declines backorder"

  order_being_fulfilled:
    current_stage: "inventory_reserved"
    evaluation_state: "fulfilling"
    can_advance: false
    can_regress: false
    actions:
      - type: "complete_packing"
        description: "Complete packing process for order"
        priority: "high"
      - type: "create_shipping_label"
        description: "Generate shipping label and tracking number"
        priority: "high"
    progress_indicators:
      - step: "picking"
        status: "completed"
        completed_at: "2024-01-16T10:00:00Z"
      - step: "packing"
        status: "in_progress"
      - step: "shipping"
        status: "pending"

  order_delivery_failed:
    current_stage: "order_shipped"
    evaluation_state: "awaiting"
    can_advance: false
    can_regress: false
    actions:
      - type: "handle_delivery_failure"
        description: "Process delivery failure and determine next steps"
        priority: "high"
    next_stage_options:
      - stage: "delivery_problem"
        condition: "Handle delivery issue"

  order_awaiting_restock:
    current_stage: "awaiting_inventory"
    evaluation_state: "awaiting"
    can_advance: false
    can_regress: false
    actions:
      - type: "monitor_inventory"
        description: "Monitor inventory levels for restocking"
        priority: "low"
    estimated_restock: "2024-01-25"
    days_waiting: 5